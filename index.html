<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MacVocab v6.3</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #888;
            --window-bg: #ffffff;
            --border-color: #000000;
        }

        body {
            font-family: 'VT323', monospace;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh; 
            height: 100dvh;
            overflow: hidden; 
            box-sizing: border-box;
            background-image: 
                linear-gradient(45deg, #aaa 25%, transparent 25%), 
                linear-gradient(-45deg, #aaa 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, #aaa 75%), 
                linear-gradient(-45deg, transparent 75%, #aaa 75%);
            background-size: 4px 4px;
            user-select: none;
            color: #000;
        }

        .window {
            background: var(--window-bg);
            border: 2px solid var(--border-color);
            box-shadow: 6px 6px 0px rgba(0,0,0,0.3);
            width: 95%;
            max-width: 650px;
            max-height: 98dvh; 
            display: flex;
            flex-direction: column;
            position: relative;
            border-radius: 2px;
        }
        
        .window.shake-effect { animation: shake 0.4s ease-in-out; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-8px); }
            40%, 80% { transform: translateX(8px); }
        }

        .title-bar {
            background: repeating-linear-gradient(0deg, #fff, #fff 2px, #000 2px, #000 4px);
            height: 32px; min-height: 32px;
            border-bottom: 2px solid var(--border-color);
            display: flex; align-items: center; justify-content: center;
            padding: 0 10px; flex-shrink: 0;
        }

        .title-box {
            background: #fff; padding: 0 15px; font-weight: bold; font-size: 1.3rem;
            border-left: 2px solid #000; border-right: 2px solid #000; letter-spacing: 1px;
        }

        .content {
            padding: 15px; display: flex; flex-direction: column; gap: 10px;
            overflow-y: auto; flex: 1; position: relative;
        }

        /* --- Modal (Report Card) --- */
        .modal-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: none;
            justify-content: center; align-items: center; z-index: 100;
        }
        .modal-window {
            background: #fff; border: 2px solid #000;
            box-shadow: 8px 8px 0 rgba(0,0,0,0.5);
            width: 85%; padding: 20px; text-align: center;
        }
        .report-card-title { font-size: 2rem; font-weight: bold; border-bottom: 2px dashed #000; margin-bottom: 15px; }
        .report-score { font-size: 3rem; font-weight: bold; margin: 10px 0; }
        .report-fraction { font-size: 1.5rem; color: #555; margin-bottom: 20px; }

        /* --- Interstitial Screen --- */
        .interstitial-box {
            flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; background: #fff;
        }
        .section-title { font-size: 3rem; font-weight: bold; margin-bottom: 10px; }
        .section-sub { font-size: 1.5rem; font-style: italic; }

        .control-group { display: flex; flex-direction: column; gap: 4px; margin-bottom: 10px; }
        label { font-weight: bold; text-transform: uppercase; font-size: 1rem; }

        select, input[type="text"] {
            font-family: 'VT323', monospace; font-size: 1.2rem; padding: 8px;
            border: 2px solid #000; background: #fff; border-radius: 0;
            width: 100%; box-sizing: border-box; outline: none;
        }
        input[type="text"]:focus { background: #eee; }
        input[type="text"]:disabled { background: #e0e0e0; color: #555; border: 2px dashed #999; }

        .btn {
            font-family: 'VT323', monospace; background: #fff; border: 2px solid #000;
            padding: 10px; font-size: 1.4rem; cursor: pointer;
            box-shadow: 3px 3px 0 #000; text-align: center;
            transition: transform 0.1s, box-shadow 0.1s; position: relative;
        }
        .btn:active { transform: translate(3px, 3px); box-shadow: 0 0 0 #000; background: #000; color: #fff; }
        .btn:disabled { opacity: 0.5; pointer-events: none; background: #ddd; box-shadow: none; border: 2px dotted #999; }
        .btn-block { width: 100%; }
        .btn-small { font-size: 1.1rem; padding: 5px 10px; box-shadow: 2px 2px 0 #000; }
        .btn-danger { border: 2px solid #000; color: #000; font-size: 1rem; box-shadow: none; border-style: dashed;}
        .btn-danger:active { background: #000; color: #fff; }
        .btn-review { border: 2px solid #000; border-style: double; font-weight: bold; background: #eee; color: #555; }
        .btn-review.has-data { background: #fff; color: #000; border-style: solid; box-shadow: 3px 3px 0 #000; }
        .btn-review.active { background: #000; color: #fff; box-shadow: inset 2px 2px 0 #555; }
        .btn.selected { background: #000; color: #fff; box-shadow: inset 3px 3px 0 #555; }

        .screen { display: none; height: 100%; flex-direction: column; }
        .screen.active { display: flex; }

        .stats-bar {
            display: flex; justify-content: space-between;
            border-bottom: 2px dashed #000; padding-bottom: 5px; margin-bottom: 10px;
            flex-shrink: 0; font-size: 1.2rem;
        }

        .activity-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 10px; } 
        .activity-btn { padding: 10px 5px; font-size: 1.1rem; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 5px; }

        .question-box { text-align: center; margin: 10px 0; flex-shrink: 0; }
        .main-word { font-size: 2.5rem; font-weight: bold; display: block; line-height: 1; margin-bottom: 5px;}
        .sub-text { font-size: 1.2rem; font-style: italic; color: #444; }
        
        .feedback-area { 
            min-height: 40px; text-align: center; font-weight: bold; margin-top: 10px;
            flex-shrink: 0; font-size: 1.2rem; border-top: 1px dotted #000; padding-top: 5px;
            transition: background 0.2s, color 0.2s;
        }
        .feedback-area.correct-state { background: #fff; color: #000; }
        .feedback-area.wrong-state { background: #000; color: #fff; }
        .correct { background: #000; color: #fff; padding: 0 5px; }
        .incorrect-msg { color: #000; font-weight: bold; }

        .choices-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; flex-grow: 1; overflow-y: auto; }
        .choices-grid .btn { font-size: 1.1rem; padding: 8px; }

        .macman-layout { display: flex; flex-direction: column; align-items: center; gap: 10px; flex-grow: 1; overflow-y: auto;}
        #macman-canvas { border: 2px solid #000; background: #fff; }
        .mm-word { font-size: 2rem; letter-spacing: 5px; font-weight: bold; }
        .keyboard { display: flex; flex-wrap: wrap; justify-content: center; gap: 4px; max-width: 400px; }
        .key-btn { width: 30px; height: 35px; font-size: 1.2rem; padding: 0; }

        .tile-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; flex-grow: 1; align-content: center; }
        .tile-card {
            background: #fff; border: 2px solid #000; height: 70px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1rem; cursor: pointer; box-shadow: 3px 3px 0 #000;
            position: relative; text-align: center; padding: 5px; line-height: 1.1;
        }
        .tile-card.flipped { background: #fff; color: #000; }
        .tile-card.hidden { background: repeating-linear-gradient(45deg, #000, #000 2px, #fff 2px, #fff 4px); color: transparent; }
        .tile-card.matched { opacity: 0; pointer-events: none; transition: opacity 0.3s; }

        .card-frame {
            border: 3px solid #000; background: #fff; padding: 20px; flex-grow: 1;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 6px 6px 0 #ccc; margin-bottom: 10px; position: relative; cursor: pointer;
        }
        .card-header-stripe {
            position: absolute; top: 4px; left: 4px; right: 4px; height: 10px;
            background: repeating-linear-gradient(45deg, #000, #000 1px, #fff 1px, #fff 3px);
            border: 1px solid #000;
        }

        .sentence-display { font-size: 1.4rem; line-height: 1.4; text-align: center; margin-bottom: 20px; }
        .blank-spot { display: inline-block; width: 80px; border-bottom: 3px solid #000; }

        .flash-word { font-size: 3rem; font-weight: bold; }
        .timer-bar { height: 10px; background: #000; width: 100%; transition: width 1s linear; margin-top: 10px;}
        
        .alpha-list { display: flex; flex-direction: column; gap: 8px; flex-grow: 1; }
        .alpha-item { 
            border: 2px solid #000; padding: 10px; font-size: 1.4rem; cursor: pointer; text-align: left;
            display: flex; align-items: center;
        }
        .alpha-item::before { content: '[FILE]'; margin-right: 10px; font-size: 0.8rem; font-family: sans-serif; }
        .alpha-item:hover { background: #eee; }
        .alpha-item.done { opacity: 0; pointer-events: none; transition: opacity 0.5s; }

        .bottom-nav { margin-top: auto; display: flex; flex-direction: column; gap: 5px; }

        @media (max-width: 400px) {
            .choices-grid { grid-template-columns: 1fr; }
            .activity-grid { grid-template-columns: 1fr 1fr; }
            .tile-grid { grid-template-columns: repeat(3, 1fr); gap: 5px; }
            .tile-card { height: 60px; font-size: 0.9rem; }
        }

    </style>
</head>
<body>

<div class="window" id="main-window">
    <div class="title-bar">
        <div class="title-box">MacVocab v6.3</div>
    </div>
    
    <div class="content">
        
        <!-- === MAIN MENU === -->
        <div id="start-screen" class="screen active">
            <div style="text-align: center; border: 2px solid #000; padding: 5px; margin-bottom: 10px; background: #eee;">
                TOTAL SCORE: <span id="total-xp">0</span> XP
            </div>

            <div class="control-group">
                <label>Input Mode:</label>
                <select id="input-mode">
                    <option value="choice">Multiple Choice (Buttons)</option>
                    <option value="type">Typing (Keyboard)</option>
                </select>
            </div>

            <div class="control-group">
                <label>Select Unit(s):</label>
                <select id="unit-select"></select>
            </div>
            
            <div id="review-area" style="margin-bottom: 10px;">
                <button id="btn-review" class="btn btn-block btn-review" onclick="toggleReviewMode()" disabled>
                    REVIEW MISSED WORDS (0)
                </button>
            </div>

            <div class="activity-grid">
                <button class="btn activity-btn" onclick="setActivity('quiz')">
                    <span>[?]</span> Definitions
                </button>
                <button class="btn activity-btn" onclick="setActivity('macman')">
                    <span>(^_^;)</span> MacMan
                </button>
                <button class="btn activity-btn" onclick="setActivity('sentence')">
                    <span>[...]</span> Sentences
                </button>
                <button class="btn activity-btn" onclick="setActivity('match')">
                    <span>[=]</span> Tile Match
                </button>
                <button class="btn activity-btn" onclick="setActivity('synant')">
                    <span>&lt;-&gt;</span> Syn/Ant ID
                </button>
                <button class="btn activity-btn" onclick="setActivity('spell')">
                    <span>(o_o)</span> Flash & Spell
                </button>
                <button class="btn activity-btn" onclick="setActivity('alpha')">
                    <span>A-Z</span> Alphabetize
                </button>
                <button class="btn activity-btn" onclick="setActivity('jumble')">
                    <span>%#@</span> Jumble
                </button>
                <button class="btn activity-btn" onclick="setActivity('cards')">
                    <span>[ ]</span> HyperCards
                </button>
            </div>

            <div class="bottom-nav" style="display:flex; flex-direction:row; gap:5px;">
                <button class="btn btn-block" style="flex:2;" onclick="startRandomGame()">RANDOM GAME</button>
                <button class="btn btn-small" style="flex:1; border: 2px dashed #000; font-size: 1rem;" onclick="startUnitTest()">TEST</button>
                <button class="btn btn-danger btn-small" style="flex:0.5; font-size:0.9rem;" onclick="resetData()">X</button>
            </div>
        </div>

        <!-- === INTERSTITIAL SCREEN === -->
        <div id="interstitial-screen" class="screen">
            <div class="interstitial-box">
                <div class="section-title" id="inter-title">SECTION</div>
                <div class="section-sub" id="inter-sub">Get Ready...</div>
            </div>
        </div>

        <!-- === QUIZ SCREEN === -->
        <div id="quiz-screen" class="screen">
            <div class="stats-bar">
                <span>Definitions</span>
                <span id="quiz-progress">1/10</span>
            </div>
            <div class="question-box">
                <span class="sub-text">Which word matches this definition?</span>
                <span id="quiz-def" style="display:block; font-size: 1.4rem; font-weight: bold; margin-top: 10px;">...</span>
            </div>
            <div id="quiz-interaction-area" style="flex-grow: 1; overflow-y: auto; display:flex; flex-direction:column; justify-content:center;"></div>
            <div id="quiz-feedback" class="feedback-area"></div>
            <button class="btn btn-small" onclick="quitGame()">Main Menu</button>
        </div>

        <!-- === MACMAN SCREEN === -->
        <div id="macman-screen" class="screen">
            <div class="stats-bar">
                <span>MacMan</span>
                <span>Wins: <span id="mm-wins">0</span></span>
            </div>
            <div class="macman-layout">
                <canvas id="macman-canvas" width="100" height="100"></canvas>
                <div id="mm-word" class="mm-word">_ _ _</div>
                <div id="mm-hint" style="text-align: center; font-style: italic; font-size: 1rem; max-width: 90%;"></div>
                <div id="mm-keys" class="keyboard"></div>
            </div>
            <div id="mm-feedback" class="feedback-area"></div>
            <button class="btn btn-small" onclick="quitGame()">Main Menu</button>
        </div>

        <!-- === SENTENCE SCREEN === -->
        <div id="sentence-screen" class="screen">
            <div class="stats-bar">
                <span>Fill in the Blank</span>
                <span id="sent-progress">1/5</span>
            </div>
            <div id="sent-text" class="sentence-display" style="flex-shrink:0;"></div>
            <div id="sent-interaction-area" style="flex-grow: 1; overflow-y: auto; display:flex; flex-direction:column; justify-content:center;"></div>
            <div id="sent-feedback" class="feedback-area"></div>
            <button class="btn btn-small" onclick="quitGame()">Main Menu</button>
        </div>

        <!-- === TILE MATCH SCREEN === -->
        <div id="match-screen" class="screen">
            <div class="stats-bar">
                <span id="match-mode-label">Synonym Match</span>
                <span id="match-score">Score: 0</span>
            </div>
            <div id="match-grid" class="tile-grid"></div>
            <div id="match-feedback" class="feedback-area"></div>
            <button class="btn btn-small" onclick="quitGame()">Main Menu</button>
        </div>

        <!-- === SYN/ANT ID SCREEN === -->
        <div id="synant-screen" class="screen">
            <div class="stats-bar">
                <span>Synonym / Antonym ID</span>
                <span id="synant-progress">1/10</span>
            </div>
            <div class="question-box">
                <span id="synant-clue" style="font-size: 1.8rem; font-weight: bold;">HAPPY</span>
                <div style="margin-top: 5px;">
                    is a <span id="synant-type" style="text-decoration:underline;">synonym</span> for...
                </div>
            </div>
            <div id="synant-interaction-area" style="flex-grow: 1; overflow-y: auto; display:flex; flex-direction:column; justify-content:center;"></div>
            <div id="synant-feedback" class="feedback-area"></div>
            <button class="btn btn-small" onclick="quitGame()">Main Menu</button>
        </div>

        <!-- === SPELL SCREEN === -->
        <div id="spell-screen" class="screen">
            <div class="stats-bar">
                <span>Flash & Spell</span>
                <span id="spell-progress">1/5</span>
            </div>
            <div id="spell-phase-1" style="flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <span class="sub-text">Memorize this word:</span>
                <span id="spell-word-display" class="flash-word">...</span>
                <span id="spell-def-display" class="sub-text" style="margin-top: 10px; max-width: 80%;">...</span>
                <div id="spell-timer" class="timer-bar"></div>
            </div>
            <div id="spell-phase-2" style="display: none; flex-grow: 1; flex-direction: column; align-items: center; justify-content: center;">
                <span class="sub-text">Type the word:</span>
                <input type="text" id="spell-input" style="text-align: center; font-size: 2rem; margin: 20px 0;" autocomplete="off">
                <button class="btn btn-block" onclick="checkSpelling()">Check</button>
            </div>
            <div id="spell-feedback" class="feedback-area"></div>
            <button class="btn btn-small" onclick="quitGame()">Main Menu</button>
        </div>

        <!-- === JUMBLE SCREEN === -->
        <div id="jumble-screen" class="screen">
            <div class="stats-bar">
                <span>Word Jumble</span>
                <span id="jumble-progress">1/10</span>
            </div>
            <div class="question-box">
                <span class="sub-text">Unscramble the letters:</span>
                <span id="jumble-word" style="display:block; font-size: 2.5rem; letter-spacing: 5px; font-weight: bold; margin: 20px 0;">...</span>
            </div>
            <div id="jumble-interaction-area" style="flex-grow: 1; overflow-y: auto; display:flex; flex-direction:column; justify-content:center;"></div>
            <div id="jumble-feedback" class="feedback-area"></div>
            <button class="btn btn-small" onclick="quitGame()">Main Menu</button>
        </div>

        <!-- === ALPHA SCREEN === -->
        <div id="alpha-screen" class="screen">
            <div class="stats-bar">
                <span>Alphabetize</span>
                <span>Click in A-Z Order</span>
            </div>
            <div id="alpha-container" class="alpha-list"></div>
            <div id="alpha-feedback" class="feedback-area"></div>
            <button class="btn btn-small" onclick="quitGame()">Main Menu</button>
        </div>

        <!-- === CARDS SCREEN === -->
        <div id="cards-screen" class="screen">
            <div class="stats-bar">
                <span>HyperCards</span>
                <span id="card-count">1/10</span>
            </div>
            <div class="card-frame" onclick="flipCard()">
                <div class="card-header-stripe"></div>
                <div id="card-content" style="text-align: center;"></div>
                <div style="position: absolute; bottom: 5px; right: 5px; font-size: 0.8rem; color: #888;">Click to flip</div>
            </div>
            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                <button class="btn" style="flex:1" onclick="prevCard()">&lt;</button>
                <button class="btn" style="flex:1" onclick="flipCard()">Flip</button>
                <button class="btn" style="flex:1" onclick="nextCard()">&gt;</button>
            </div>
            <button class="btn btn-small" onclick="quitGame()">Main Menu</button>
        </div>

    </div>

    <!-- === TEST REPORT CARD MODAL === -->
    <div id="report-modal" class="modal-overlay">
        <div class="modal-window">
            <div class="report-card-title">UNIT TEST REPORT</div>
            <div class="report-score" id="report-percent">95%</div>
            <div class="report-fraction" id="report-fraction">19 / 20 Correct</div>
            <button class="btn btn-block" onclick="closeReportCard()">Close</button>
        </div>
    </div>

</div>

<script>
    const RAW_DATA = [
        // UNIT 1
        { u: 1, w: "celebrity", d: "A famous person.", s: "star, famous person", a: "unknown, nobody", ex: "The singer is a huge ______ with millions of fans." },
        { u: 1, w: "counsel", d: "To give advice; advice.", s: "advise, guidance", a: "ignore, disregard", ex: "The coach offered wise ______ on how to win the game." },
        { u: 1, w: "demonstrate", d: "To show clearly or explain.", s: "show, prove", a: "hide, conceal", ex: "Can you ______ how to solve that math problem?" },
        { u: 1, w: "drowsy", d: "Feeling sleepy or tired.", s: "sleepy, tired", a: "alert, awake", ex: "The warm milk made the baby feel ______." },
        { u: 1, w: "essential", d: "Completely necessary or important.", s: "necessary, vital", a: "unnecessary, optional", ex: "A helmet is ______ for riding a bike safely." },
        { u: 1, w: "hardship", d: "A difficulty or trouble.", s: "difficulty, suffering", a: "ease, comfort", ex: "The pioneers faced many ______ during their journey." },
        { u: 1, w: "haul", d: "To pull or drag with effort.", s: "drag, pull", a: "push, carry lightly", ex: "We had to ______ the heavy logs up the hill." },
        { u: 1, w: "humble", d: "Not proud; modest; simple.", s: "modest, plain", a: "proud, arrogant", ex: "Despite his success, he remained a very ______ man." },
        { u: 1, w: "pledge", d: "A serious promise.", s: "promise, vow", a: "break, deny", ex: "I made a ______ to always tell the truth." },
        { u: 1, w: "sincere", d: "Honest and truthful.", s: "honest, genuine", a: "fake, insincere", ex: "Her apology was ______, so I forgave her." },
        { u: 1, w: "stampede", d: "A sudden rush of startled animals or people.", s: "rush, bolt", a: "retreat, calm", ex: "The loud noise caused a ______ of cattle." },
        { u: 1, w: "suitable", d: "Right for a certain purpose; proper.", s: "appropriate, fitting", a: "unsuitable, wrong", ex: "These shoes are not ______ for hiking." },
        
        // --- PASTE YOUR UNITS 2-17 HERE ---
        
    // UNIT 2
    { u: 2, w: "annual", d: "Happening once a year.", s: "yearly, periodic", a: "daily, never", ex: "The town holds an ______ summer festival in July." },
    { u: 2, w: "basic", d: "Simple or fundamental.", s: "simple, main", a: "complex, advanced", ex: "Learning to read is a ______ skill for life." },
    { u: 2, w: "competition", d: "A contest or rivalry.", s: "contest, challenge", a: "cooperation, agreement", ex: "The two teams were in a tough ______ for the trophy." },
    { u: 2, w: "contract", d: "A written agreement.", s: "agreement, deal", a: "disagreement, breakup", ex: "They signed a ______ to buy the new house." },
    { u: 2, w: "dismiss", d: "To send away or let go.", s: "fire, let go", a: "hire, keep", ex: "The teacher had to ______ the student for bad behavior." },
    { u: 2, w: "neglect", d: "To fail to take care of something.", s: "ignore, abandon", a: "care for, attend to", ex: "If you ______ your homework, your grades will fall." },
    { u: 2, w: "obtain", d: "To get or acquire.", s: "get, gain", a: "lose, forfeit", ex: "She worked hard to ______ a good grade on the test." },
    { u: 2, w: "portion", d: "A part or share of something.", s: "share, part", a: "whole, entirety", ex: "I saved a small ______ of my dessert for later." },
    { u: 2, w: "recall", d: "To remember something.", s: "remember, recollect", a: "forget, overlook", ex: "I couldn't ______ the name of the movie we watched." },
    { u: 2, w: "sponsor", d: "A person or group who supports another.", s: "supporter, backer", a: "opponent, rival", ex: "A local business agreed to ______ the school's field day." },
    { u: 2, w: "stern", d: "Strict or serious.", s: "serious, strict", a: "gentle, easygoing", ex: "The principal gave a ______ warning about running in the halls." },
    { u: 2, w: "vacant", d: "Empty; not filled or occupied.", s: "empty, unoccupied", a: "occupied, full", ex: "The apartment has been ______ since the last tenants moved out." },

    // UNIT 3
    { u: 3, w: "attractive", d: "Pleasing to the eye or mind.", s: "pretty, appealing", a: "ugly, repulsive", ex: "The brightly colored flowers were very ______." },
    { u: 3, w: "burden", d: "A heavy load; something difficult to carry.", s: "load, worry", a: "ease, relief", ex: "The heavy backpack was a big ______ on the small child." },
    { u: 3, w: "consent", d: "To agree to something; agreement.", s: "agree, permission", a: "refuse, denial", ex: "You need your parents' ______ to go on the trip." },
    { u: 3, w: "dependable", d: "Trustworthy; reliable.", s: "reliable, trustworthy", a: "unreliable, shaky", ex: "A good friend should always be ______." },
    { u: 3, w: "indicate", d: "To point out or show.", s: "show, point to", a: "hide, conceal", ex: "The sign will ______ where the museum is located." },
    { u: 3, w: "previous", d: "Happening before or earlier.", s: "former, preceding", a: "next, following", ex: "We reviewed the material from the ______ chapter." },
    { u: 3, w: "qualify", d: "To meet the requirements or be fit for something.", s: "meet requirements, fit", a: "disqualify, be unfit", ex: "You need a license to ______ to drive a car." },
    { u: 3, w: "response", d: "An answer or reply.", s: "answer, reply", a: "question, query", ex: "I sent an email and waited for a ______." },
    { u: 3, w: "shabby", d: "Worn out or old-looking.", s: "worn, ragged", a: "new, clean", ex: "The old couch looked ______ and needed a new cover." },
    { u: 3, w: "thaw", d: "To melt or warm up.", s: "melt, defrost", a: "freeze, solidify", ex: "The snow began to ______ as the sun came out." },

    // UNIT 4
    { u: 4, w: "ambush", d: "A surprise attack from a hidden position.", s: "trap, surprise attack", a: "open attack, stand down", ex: "The soldiers planned an ______ in the thick woods." },
    { u: 4, w: "calculate", d: "To figure out using math.", s: "figure out, compute", a: "guess, estimate", ex: "I need to ______ how much paint we need for the room." },
    { u: 4, w: "contribute", d: "To give to a common purpose.", s: "donate, give", a: "take, withhold", ex: "Everyone should ______ a little money to the school fundraiser." },
    { u: 4, w: "dread", d: "To fear greatly or look forward to with fear.", s: "fear, worry", a: "welcome, anticipate happily", ex: "She ______ having to speak in front of the whole class." },
    { u: 4, w: "employ", d: "To hire someone for work.", s: "hire, use", a: "fire, dismiss", ex: "The company will ______ twenty new workers this year." },
    { u: 4, w: "extend", d: "To stretch out or make longer.", s: "lengthen, stretch", a: "shorten, contract", ex: "Can you ______ your arm so I can reach your hand?" },
    { u: 4, w: "frantic", d: "Wildly excited or worried.", s: "desperate, worried", a: "calm, peaceful", ex: "We made a ______ search for the lost car keys." },
    { u: 4, w: "initial", d: "First or beginning.", s: "beginning, starting", a: "final, last", ex: "The ______ plan was different from the final one." },
    { u: 4, w: "routine", d: "A regular, fixed way of doing things.", s: "schedule, habit", a: "random, unusual", ex: "Brushing your teeth is part of your daily ______." },
    { u: 4, w: "stun", d: "To shock or surprise greatly.", s: "amaze, daze", a: "bore, calm", ex: "The amazing magic trick completely ______ the audience." },
    { u: 4, w: "sturdy", d: "Strong and well-made.", s: "strong, solid", a: "weak, flimsy", ex: "The oak table was ______ and would last for years." },
    { u: 4, w: "yield", d: "To produce or give way to.", s: "produce, surrender", a: "keep, hold onto", ex: "The garden will ______ many fresh vegetables this summer." },

    // UNIT 5
    { u: 5, w: "antique", d: "Very old and valuable.", s: "old, vintage", a: "new, modern", ex: "She bought an ______ clock at the flea market." },
    { u: 5, w: "baggage", d: "Suitcases and belongings for travel.", s: "luggage, bags", a: "excess, clutter", ex: "We put all of our ______ in the trunk of the car." },
    { u: 5, w: "digest", d: "To break down food in the stomach.", s: "process, absorb", a: "reject, ignore", ex: "It takes time for your stomach to ______ a large meal." },
    { u: 5, w: "establish", d: "To set up or start.", s: "create, found", a: "demolish, end", ex: "They hope to ______ a new school in the neighborhood." },
    { u: 5, w: "eternal", d: "Lasting forever; endless.", s: "everlasting, endless", a: "temporary, short-lived", ex: "Many people believe the stars are a sign of ______ peace." },
    { u: 5, w: "haste", d: "Speed or quickness.", s: "hurry, rush", a: "slowness, delay", ex: "They finished the project in ______ and made many mistakes." },
    { u: 5, w: "humid", d: "Having a lot of moisture or water vapor in the air.", s: "damp, moist", a: "dry, arid", ex: "The air was hot and ______ right before the thunderstorm." },
    { u: 5, w: "lash", d: "To tie down or fasten securely.", s: "tie, fasten", a: "unfasten, untie", ex: "Make sure to ______ the boat to the dock with a strong rope." },
    { u: 5, w: "oppose", d: "To be against something.", s: "resist, fight", a: "support, agree with", ex: "Most of the students ______ the idea of longer school days." },
    { u: 5, w: "pioneer", d: "A person who goes first and settles a new land.", s: "settler, trailblazer", a: "follower, successor", ex: "The ______ traveled West to start a new life." },
    { u: 5, w: "sensible", d: "Showing good judgment or common sense.", s: "practical, wise", a: "foolish, illogical", ex: "Wearing a warm coat in winter is a ______ idea." },
    { u: 5, w: "worthy", d: "Deserving of respect or attention.", s: "deserving, excellent", a: "unworthy, bad", ex: "He proved himself to be a ______ leader for the class." },

    // UNIT 6
    { u: 6, w: "blossom", d: "A flower or to flower.", s: "bloom, flower", a: "fade, wither", ex: "The apple trees began to ______ in the spring." },
    { u: 6, w: "collide", d: "To crash into each other.", s: "crash, strike", a: "avoid, miss", ex: "Two cars ______ on the icy road." },
    { u: 6, w: "constant", d: "Happening all the time; never-ending.", s: "continuous, steady", a: "irregular, brief", ex: "The ______ noise from the construction site was annoying." },
    { u: 6, w: "content", d: "Happy and satisfied.", s: "satisfied, pleased", a: "unhappy, displeased", ex: "After a good meal, the baby felt ______ and fell asleep." },
    { u: 6, w: "distract", d: "To pull attention away from something.", s: "divert, bother", a: "focus, concentrate", ex: "Don't let the noise ______ you from your schoolwork." },
    { u: 6, w: "drought", d: "A long period without rain.", s: "dryness, lack of rain", a: "flood, downpour", ex: "The farm crops wilted during the long summer ______." },
    { u: 6, w: "foul", d: "Offensive or disgusting; against the rules.", s: "gross, wrong", a: "pleasant, fair", ex: "The rotten eggs had a ______ smell." },
    { u: 6, w: "noble", d: "High in moral quality; a high-ranking person.", s: "honorable, royal", a: "dishonorable, common", ex: "The knight performed a ______ act by saving the child." },
    { u: 6, w: "policy", d: "A rule or plan of action.", s: "rule, plan", a: "disorder, exception", ex: "The school has a strict ______ about being on time." },
    { u: 6, w: "quiver", d: "To tremble or shake slightly.", s: "shake, shiver", a: "stay still, calm", ex: "The tiny mouse began to ______ with fear." },
    { u: 6, w: "slight", d: "Small in amount; minor.", s: "small, minor", a: "large, huge", ex: "There was only a ______ chance of rain today." },
    { u: 6, w: "tidy", d: "Neat and orderly.", s: "neat, organized", a: "messy, disorganized", ex: "Please make sure your bedroom is ______ before playing games." },

    // UNIT 7
    { u: 7, w: "accurate", d: "Exactly correct; without mistakes.", s: "correct, exact", a: "wrong, false", ex: "She used a ruler to make sure her measurements were ______." },
    { u: 7, w: "alert", d: "Watchful and ready.", s: "watchful, attentive", a: "asleep, unaware", ex: "A good guard dog is always ______ for danger." },
    { u: 7, w: "ancestor", d: "A relative who lived in the past.", s: "forebear, relative", a: "descendant, offspring", ex: "My ______ came to this country many years ago." },
    { u: 7, w: "disaster", d: "A sudden event that causes great damage.", s: "catastrophe, tragedy", a: "blessing, success", ex: "The earthquake was a terrible ______ for the city." },
    { u: 7, w: "elementary", d: "Basic or simple.", s: "simple, beginning", a: "advanced, complex", ex: "First grade is the beginning of ______ school." },
    { u: 7, w: "envy", d: "To want what someone else has.", s: "jealousy, desire", a: "contentment, satisfaction", ex: "I felt ______ for my friend's brand-new bicycle." },
    { u: 7, w: "epidemic", d: "A sudden, widespread outbreak of a disease.", s: "outbreak, plague", a: "cure, rarity", ex: "A severe flu caused a widespread ______ in the city." },
    { u: 7, w: "feeble", d: "Weak and without strength.", s: "weak, frail", a: "strong, powerful", ex: "The sick man was too ______ to get out of bed." },
    { u: 7, w: "penetrate", d: "To go into or through something.", s: "pierce, bore", a: "exit, pull out", ex: "The sharp thorn managed to ______ the thick leather glove." },
    { u: 7, w: "romp", d: "To play or move in a lively, spirited way.", s: "play, frolic", a: "rest, walk slowly", ex: "The puppies ______ happily in the tall grass." },
    { u: 7, w: "staple", d: "A basic or necessary item.", s: "essential, main product", a: "extra, luxury", ex: "Rice is a ______ food in many countries." },
    { u: 7, w: "survive", d: "To stay alive or continue to exist.", s: "live, endure", a: "perish, die", ex: "Very few animals can ______ in the cold desert at night." },

    // UNIT 8
    { u: 8, w: "awkward", d: "Clumsy or difficult to handle.", s: "clumsy, uncomfortable", a: "graceful, smooth", ex: "Carrying three big boxes was an ______ task." },
    { u: 8, w: "clatter", d: "A loud, rattling noise.", s: "noise, racket", a: "silence, quiet", ex: "The plates made a loud ______ when they fell off the shelf." },
    { u: 8, w: "gallant", d: "Brave and heroic.", s: "brave, heroic", a: "cowardly, fearful", ex: "The ______ knight defended the castle from the dragon." },
    { u: 8, w: "lukewarm", d: "Slightly warm; neither hot nor cold.", s: "tepid, mild", a: "hot, icy", ex: "The tea was only ______ and needed to be heated up." },
    { u: 8, w: "plentiful", d: "Existing in large supply.", s: "abundant, ample", a: "scarce, rare", ex: "Wild berries are ______ in the forest during summer." },
    { u: 8, w: "ration", d: "A fixed amount of something allowed to a person.", s: "allowance, share", a: "entire amount, excess", ex: "During the war, the government had to ______ food." },
    { u: 8, w: "reserve", d: "To hold back or save for later.", s: "save, hold", a: "use, spend", ex: "We must ______ a table at the restaurant ahead of time." },
    { u: 8, w: "scholar", d: "A person who studies a lot and knows a lot.", s: "learned person, expert", a: "beginner, ignorant person", ex: "She is a brilliant ______ in the field of ancient history." },
    { u: 8, w: "smolder", d: "To burn slowly with smoke but no flame.", s: "burn, smoke", a: "flare, extinguish", ex: "The campfire began to ______ after the flames went out." },
    { u: 8, w: "trudge", d: "To walk slowly and with heavy steps.", s: "lumber, plod", a: "skip, walk quickly", ex: "We had to ______ through the deep, wet snow." },
    { u: 8, w: "volunteer", d: "A person who offers to do a service freely.", s: "helper, unpaid worker", a: "paid worker, forced labor", ex: "I decided to ______ my time at the animal shelter." },
    { u: 8, w: "weary", d: "Physically or mentally tired.", s: "tired, exhausted", a: "energetic, refreshed", ex: "The long hike made my legs feel ______." },

    // UNIT 9
    { u: 9, w: "convict", d: "To find someone guilty of a crime.", s: "find guilty, sentence", a: "acquit, pardon", ex: "The jury voted to ______ the suspect of the crime." },
    { u: 9, w: "discipline", d: "Training to obey rules; self-control.", s: "obedience, training", a: "chaos, disorder", ex: "Learning to play an instrument takes great ______." },
    { u: 9, w: "dungeon", d: "A dark, underground prison cell.", s: "jail, cell", a: "sky, freedom", ex: "The prisoner was locked away in the castle's ______." },
    { u: 9, w: "earnest", d: "Serious and sincere.", s: "serious, sincere", a: "playful, shallow", ex: "She made an ______ effort to study for the difficult exam." },
    { u: 9, w: "enclose", d: "To surround or close off on all sides.", s: "surround, fence in", a: "open, release", ex: "They will ______ the yard with a wooden fence." },
    { u: 9, w: "gradual", d: "Happening slowly over a long period.", s: "slow, steady", a: "sudden, rapid", ex: "The change in the weather was ______ as winter arrived." },
    { u: 9, w: "grumble", d: "To complain in a low voice.", s: "complain, mutter", a: "cheer, praise", ex: "He began to ______ about having to clean his room." },
    { u: 9, w: "jagged", d: "Having sharp, uneven points.", s: "rough, spiky", a: "smooth, even", ex: "The broken glass left a ______ edge on the table." },
    { u: 9, w: "nourish", d: "To provide food or support for growth.", s: "feed, nurture", a: "starve, neglect", ex: "Good food and rest will ______ a growing child." },
    { u: 9, w: "provision", d: "A supply of necessary items, especially food.", s: "supply, arrangement", a: "lack, scarcity", ex: "We bought extra food and ______ for the long camping trip." },
    { u: 9, w: "treaty", d: "A formal agreement between two or more countries.", s: "agreement, pact", a: "disagreement, conflict", ex: "The two nations signed a peace ______ to end the war." },
    { u: 9, w: "uneasy", d: "Feeling worried or uncomfortable.", s: "worried, anxious", a: "calm, relaxed", ex: "I felt ______ when I was home alone in the dark." },

    // UNIT 10
    { u: 10, w: "distress", d: "Great pain, suffering, or sadness.", s: "pain, trouble", a: "comfort, joy", ex: "The stranded hikers were in great ______." },
    { u: 10, w: "drench", d: "To make completely wet.", s: "soak, saturate", a: "dry, parch", ex: "The sudden rainstorm will ______ everyone who is outside." },
    { u: 10, w: "dwell", d: "To live in a place.", s: "live, reside", a: "move, leave", ex: "I have always wished to ______ in a house near the ocean." },
    { u: 10, w: "juvenile", d: "Relating to young people; a young person.", s: "young, youthful", a: "adult, mature", ex: "The crime committed by the teenager was a ______ offense." },
    { u: 10, w: "outstanding", d: "Excellent or very noticeable.", s: "excellent, amazing", a: "bad, average", ex: "She gave an ______ performance in the school play." },
    { u: 10, w: "proceed", d: "To move forward or go on.", s: "continue, advance", a: "stop, retreat", ex: "We waited for the light to turn green before we could ______." },
    { u: 10, w: "register", d: "To record or enroll officially.", s: "sign up, enroll", a: "withdraw, forget", ex: "You need to ______ to vote in the upcoming election." },
    { u: 10, w: "sift", d: "To put a fine material through a strainer.", s: "strain, filter", a: "lump, combine", ex: "You should always ______ the flour before baking a cake." },
    { u: 10, w: "spree", d: "A lively or wild outburst of activity.", s: "binge, burst", a: "scarcity, lack", ex: "They went on a shopping ______ and spent all their money." },
    { u: 10, w: "tardy", d: "Late; not on time.", s: "late, delayed", a: "early, on time", ex: "Students who are ______ will need to get a note from the office." },
    { u: 10, w: "unfit", d: "Not suitable or good enough.", s: "unsuitable, unhealthy", a: "suitable, fit", ex: "Eating too much junk food will make you ______ for sports." },
    { u: 10, w: "variety", d: "A number of different kinds.", s: "assortment, mix", a: "same, uniformity", ex: "The store offers a large ______ of fresh fruits and vegetables." },

    // UNIT 11
    { u: 11, w: "blockade", d: "A barrier that prevents movement.", s: "barrier, stop", a: "opening, path", ex: "The fallen tree created a ______ across the main road." },
    { u: 11, w: "chant", d: "To sing or say in a repeating, rhythmic way.", s: "sing, repeat", a: "whisper, speak softly", ex: "The crowd began to ______ the name of their favorite player." },
    { u: 11, w: "despair", d: "A feeling of complete lack of hope.", s: "hopelessness, sadness", a: "hope, happiness", ex: "After losing his dog, he fell into deep ______." },
    { u: 11, w: "elevate", d: "To lift or raise to a higher position.", s: "lift, raise", a: "lower, drop", ex: "We used a crane to ______ the materials to the roof." },
    { u: 11, w: "extraordinary", d: "Beyond the usual; remarkable.", s: "amazing, special", a: "ordinary, normal", ex: "It was an ______ rescue, as they saved all the passengers." },
    { u: 11, w: "heroic", d: "Very brave and showing great courage.", s: "brave, courageous", a: "cowardly, weak", ex: "The firefighter made a ______ effort to save the cat from the tree." },
    { u: 11, w: "lance", d: "A long, sharp weapon for thrusting.", s: "spear, weapon", a: "shield, protection", ex: "The knight carried a ______ as he rode his horse into battle." },
    { u: 11, w: "missionary", d: "A person sent to promote a religion in a foreign country.", s: "evangelist, preacher", a: "skeptic, nonbeliever", ex: "The ______ traveled overseas to help the poor." },
    { u: 11, w: "pointless", d: "Having no purpose or meaning.", s: "useless, senseless", a: "useful, meaningful", ex: "Arguing about the weather is completely ______." },
    { u: 11, w: "reflect", d: "To think deeply about something; to bounce back light.", s: "consider, mirror", a: "ignore, absorb", ex: "She took a moment to ______ on her mistakes." },
    { u: 11, w: "site", d: "A location or area.", s: "location, place", a: "entire area, non-place", ex: "This ______ is where the new school will be built." },
    { u: 11, w: "toxic", d: "Poisonous or harmful.", s: "poisonous, deadly", a: "harmless, safe", ex: "Be careful not to spill any of the ______ cleaning chemicals." },

    // UNIT 12
    { u: 12, w: "bristle", d: "A short, stiff hair; to show sudden anger.", s: "hair, spine", a: "smooth skin, calmness", ex: "The boar's coarse ______ felt rough to the touch." },
    { u: 12, w: "circular", d: "Having the shape of a circle.", s: "round, ring-shaped", a: "straight, square", ex: "They sat around the ______ table to play a game." },
    { u: 12, w: "coarse", d: "Rough or harsh in texture.", s: "rough, scratchy", a: "smooth, soft", ex: "The sandpaper felt very ______ against my skin." },
    { u: 12, w: "discard", d: "To throw away or get rid of.", s: "throw away, toss", a: "keep, save", ex: "Please ______ all your trash into the proper bin." },
    { u: 12, w: "extreme", d: "The greatest or farthest point.", s: "intense, maximum", a: "moderate, mild", ex: "Climbing Mount Everest is an ______ challenge." },
    { u: 12, w: "focus", d: "To concentrate attention on something.", s: "concentrate, center", a: "ignore, disperse", ex: "Try to ______ on your book and ignore the noise." },
    { u: 12, w: "grasp", d: "To take hold of something firmly.", s: "grip, hold", a: "release, drop", ex: "She used a strong hand to ______ the rope firmly." },
    { u: 12, w: "inspire", d: "To fill someone with the urge or ability to do something.", s: "motivate, encourage", a: "discourage, bore", ex: "Her story will ______ others to chase their dreams." },
    { u: 12, w: "magnify", d: "To make something look larger than it is.", s: "enlarge, zoom in", a: "shrink, reduce", ex: "We used a lens to ______ the tiny insects." },
    { u: 12, w: "marine", d: "Relating to the sea or ocean.", s: "sea, aquatic", a: "land, terrestrial", ex: "Whales and dolphins are beautiful ______ animals." },
    { u: 12, w: "quake", d: "To shake or tremble.", s: "shake, shiver", a: "stabilize, hold firm", ex: "The old house seemed to ______ during the loud thunderstorm." },
    { u: 12, w: "troublesome", d: "Causing difficulty or annoyance.", s: "annoying, difficult", a: "easy, pleasant", ex: "The constant barking of the dog was quite ______." },

    // UNIT 13
    { u: 13, w: "abstract", d: "Existing only as an idea; not concrete.", s: "theoretical, non-physical", a: "concrete, real", ex: "Happiness is an ______ idea that is hard to describe." },
    { u: 13, w: "ally", d: "A person or country joined with another for a common purpose.", s: "partner, friend", a: "enemy, opponent", ex: "The two nations became close ______ to fight a war." },
    { u: 13, w: "appoint", d: "To choose a person for a job or position.", s: "select, assign", a: "dismiss, remove", ex: "The president will ______ a new judge to the court." },
    { u: 13, w: "attentive", d: "Paying close attention.", s: "observant, watchful", a: "careless, distracted", ex: "She was an ______ listener in class and took good notes." },
    { u: 13, w: "bonus", d: "Something extra given as a reward.", s: "extra, reward", a: "loss, penalty", ex: "The company gave everyone a large ______ at the end of the year." },
    { u: 13, w: "carefree", d: "Without worries; lighthearted.", s: "relaxed, cheerful", a: "worried, serious", ex: "We spent a ______ summer afternoon swimming in the lake." },
    { u: 13, w: "courtesy", d: "Polite behavior; good manners.", s: "politeness, respect", a: "rudeness, disrespect", ex: "She showed great ______ by holding the door open for the elderly man." },
    { u: 13, w: "manufacture", d: "To make something, usually in a factory.", s: "produce, make", a: "destroy, buy", ex: "The factory is able to ______ hundreds of toys each day." },
    { u: 13, w: "mistrust", d: "Lack of trust or confidence.", s: "doubt, suspicion", a: "trust, belief", ex: "The long history of lies caused deep ______ between them." },
    { u: 13, w: "noticeable", d: "Easy to see or observe.", s: "obvious, clear", a: "hidden, invisible", ex: "The difference in their heights was very ______." },
    { u: 13, w: "overthrow", d: "To remove from power; to defeat.", s: "remove, topple", a: "install, support", ex: "The people planned to ______ the cruel king." },
    { u: 13, w: "peculiar", d: "Strange or unusual.", s: "odd, strange", a: "normal, common", ex: "The dog had a ______ habit of chasing its own tail." },

    // UNIT 14
    { u: 14, w: "absolute", d: "Complete, total, or without limits.", s: "total, entire", a: "partial, limited", ex: "You have my ______ permission to use my computer." },
    { u: 14, w: "arena", d: "A place for public events or sports.", s: "stadium, venue", a: "home, private space", ex: "The famous singer will perform in the large city ______." },
    { u: 14, w: "compliment", d: "An expression of praise or admiration.", s: "praise, flattery", a: "insult, criticism", ex: "The teacher gave the student a ______ on her good writing." },
    { u: 14, w: "deliberate", d: "Done on purpose; carefully considered.", s: "intentional, planned", a: "accidental, careless", ex: "The slow movements were careful and ______." },
    { u: 14, w: "dense", d: "Closely packed together; thick.", s: "thick, crowded", a: "sparse, thin", ex: "The forest was so ______ that sunlight could barely reach the ground." },
    { u: 14, w: "dominant", d: "Most important, powerful, or controlling.", s: "main, powerful", a: "minor, weak", ex: "The lion is the ______ animal in the savanna." },
    { u: 14, w: "hazardous", d: "Dangerous or risky.", s: "dangerous, unsafe", a: "safe, secure", ex: "Do not go near the sign that says \"______ materials.\"" },
    { u: 14, w: "huddle", d: "To crowd together closely.", s: "cluster, gather", a: "scatter, spread out", ex: "The sheep began to ______ together for warmth in the snow." },
    { u: 14, w: "necessity", d: "Something that is needed or essential.", s: "requirement, must-have", a: "luxury, extra", ex: "Food and water are a basic ______ for all life." },
    { u: 14, w: "offend", d: "To hurt someone's feelings; to insult.", s: "insult, displease", a: "compliment, please", ex: "I hope I didn't ______ you with my clumsy comment." },
    { u: 14, w: "regain", d: "To get something back.", s: "recover, restore", a: "lose, surrender", ex: "He worked hard to ______ his health after the long illness." },
    { u: 14, w: "thorough", d: "Complete and very careful.", s: "careful, detailed", a: "careless, incomplete", ex: "The detective did a ______ search of the entire house." },

    // UNIT 15
    { u: 15, w: "adopt", d: "To take a child into your family or to take up an idea.", s: "take in, accept", a: "reject, abandon", ex: "The couple decided to ______ a child from the orphanage." },
    { u: 15, w: "agile", d: "Able to move quickly and easily.", s: "nimble, quick", a: "clumsy, stiff", ex: "The mountain goat was very ______ as it climbed the rocks." },
    { u: 15, w: "analyze", d: "To study something closely and carefully.", s: "examine, study", a: "guess, ignore", ex: "The scientist will ______ the soil sample for traces of pollution." },
    { u: 15, w: "assist", d: "To help or aid someone.", s: "help, aid", a: "hinder, block", ex: "The older student agreed to ______ the younger kids with their math homework." },
    { u: 15, w: "babble", d: "To make sounds like a baby; to talk foolishly.", s: "chatter, mumble", a: "speak clearly, be quiet", ex: "The little baby would often ______ when playing with toys." },
    { u: 15, w: "captivity", d: "The state of being held as a prisoner.", s: "imprisonment, confinement", a: "freedom, liberty", ex: "The zoo works to protect animals kept in ______." },
    { u: 15, w: "drab", d: "Dull, boring, and colorless.", s: "dull, uninteresting", a: "bright, colorful", ex: "The walls of the old building were a ______ shade of gray." },
    { u: 15, w: "fatal", d: "Causing death.", s: "deadly, lethal", a: "harmless, safe", ex: "The fall from the cliff proved to be ______." },
    { u: 15, w: "generosity", d: "The quality of being kind and giving.", s: "kindness, giving", a: "selfishness, greed", ex: "Her ______ led her to donate a lot of money to the poor." },
    { u: 15, w: "genuine", d: "Real, true, or sincere.", s: "real, authentic", a: "fake, false", ex: "I could tell by her smile that her happiness was ______." },
    { u: 15, w: "illegal", d: "Against the law.", s: "unlawful, forbidden", a: "legal, lawful", ex: "Driving without a license is completely ______." },
    { u: 15, w: "merit", d: "Deserving of reward or praise.", s: "worth, value", a: "fault, flaw", ex: "The judges decided the painting had great artistic ______." },

    // UNIT 16
    { u: 16, w: "adorn", d: "To decorate or make beautiful.", s: "decorate, embellish", a: "strip, damage", ex: "She used flowers and lights to ______ the party room." },
    { u: 16, w: "appropriate", d: "Right for the purpose; suitable.", s: "suitable, proper", a: "inappropriate, wrong", ex: "That outfit is not ______ for a formal wedding ceremony." },
    { u: 16, w: "assemble", d: "To bring or put together.", s: "gather, connect", a: "scatter, disassemble", ex: "We need to ______ all the parts to build the new toy." },
    { u: 16, w: "colossal", d: "Extremely large or huge.", s: "huge, gigantic", a: "tiny, small", ex: "The new skyscraper was a ______ building in the city skyline." },
    { u: 16, w: "effective", d: "Producing the desired result.", s: "successful, potent", a: "useless, weak", ex: "This medicine is very ______ at curing a headache." },
    { u: 16, w: "frail", d: "Weak and easily damaged.", s: "delicate, weak", a: "strong, sturdy", ex: "The small bird seemed so ______ in the cold winter air." },
    { u: 16, w: "hostage", d: "A person held prisoner until demands are met.", s: "captive, prisoner", a: "guard, captor", ex: "The criminals held the bank manager as a ______." },
    { u: 16, w: "landslide", d: "A sudden, rapid movement of earth and rocks down a slope.", s: "mudslide, collapse", a: "stability, firmness", ex: "Heavy rain caused a ______ that blocked the mountain road." },
    { u: 16, w: "rampage", d: "To rush around in a wild, destructive way.", s: "storm, rush", a: "calm, be gentle", ex: "The escaped tiger went on a destructive ______ through the jungle." },
    { u: 16, w: "scamper", d: "To run or move quickly and playfully.", s: "dash, hurry", a: "stroll, walk slowly", ex: "The little squirrel began to ______ up the oak tree." },
    { u: 16, w: "symptom", d: "A sign or indication of a disease.", s: "sign, indication", a: "cause, cure", ex: "A fever can be a ______ of the flu." },
    { u: 16, w: "warrant", d: "A written order that gives authority; to justify.", s: "authorization, justify", a: "denial, ignore", ex: "The police needed a ______ to search the house." },

    // UNIT 17
    { u: 17, w: "approximate", d: "Close to the actual amount; nearly exact.", s: "estimate, near", a: "exact, precise", ex: "I can only give you an ______ guess of the travel time." },
    { u: 17, w: "construct", d: "To build or put together.", s: "build, make", a: "demolish, destroy", ex: "The workers plan to ______ a new bridge over the river." },
    { u: 17, w: "crude", d: "Not carefully made; rough or simple.", s: "raw, simple", a: "refined, polished", ex: "The settlers lived in a ______ cabin made of logs." },
    { u: 17, w: "decline", d: "To refuse to accept; to gradually fall.", s: "refuse, drop", a: "accept, increase", ex: "The price of gasoline began to ______ after the holidays." },
    { u: 17, w: "distinct", d: "Clearly different; easily seen.", s: "clear, separate", a: "vague, similar", ex: "The parrot has two ______ colors on its wings." },
    { u: 17, w: "evident", d: "Easy to see or understand; obvious.", s: "obvious, clear", a: "hidden, unclear", ex: "It was ______ from her smile that she was very happy." },
    { u: 17, w: "impulse", d: "A sudden, strong desire to act.", s: "urge, whim", a: "plan, thought", ex: "I bought the candy bar on a sudden ______ at the checkout." },
    { u: 17, w: "interpret", d: "To explain the meaning of something.", s: "explain, translate", a: "confuse, misunderstand", ex: "The travel guide was there to ______ the ancient writings." },
    { u: 17, w: "orient", d: "To adjust to a situation or position.", s: "align, adapt", a: "confuse, disorient", ex: "The map helped us ______ ourselves in the new city." },
    { u: 17, w: "sector", d: "A part or division of an area.", s: "part, zone", a: "whole, entirety", ex: "The police searched the northeast ______ of the park." },
    { u: 17, w: "submit", d: "To give in to another's power; to present for review.", s: "yield, hand in", a: "resist, withdraw", ex: "You must ______ your final paper by the end of the day." },
    { u: 17, w: "zest", d: "Great enthusiasm or excitement.", s: "enthusiasm, energy", a: "dullness, boredom", ex: "She went on the trip with great ______ and excitement." },

 
        // UNIT 18
        { u: 18, w: "depress", d: "To make sad or lower in spirits.", s: "sadden, discourage", a: "cheer, elevate", ex: "The gray, rainy weather began to ______ my mood." },
        { u: 18, w: "dismal", d: "Causing gloom or sadness.", s: "gloomy, sad", a: "cheerful, joyful", ex: "The team played a ______ game and lost by a large score." },
        { u: 18, w: "dispose", d: "To get rid of something.", s: "discard, dump", a: "keep, save", ex: "Please ______ of your garbage in the proper bin." },
        { u: 18, w: "exaggerate", d: "To describe something as larger or greater than it really is.", s: "overstate, inflate", a: "minimize, understate", ex: "He tends to ______ his stories to make them sound more exciting." },
        { u: 18, w: "indifferent", d: "Not caring or interested.", s: "unconcerned, uncaring", a: "interested, concerned", ex: "I was ______ as to whether we watched a movie or read a book." },
        { u: 18, w: "jubilant", d: "Feeling or expressing great joy.", s: "joyful, thrilled", a: "sad, depressed", ex: "The crowd was ______ when their team won the championship." },
        { u: 18, w: "manual", d: "Done by hand; a handbook.", s: "hand-operated, guide", a: "automatic, digital", ex: "Turning the large crank required ______ effort." },
        { u: 18, w: "originate", d: "To come from or begin somewhere.", s: "begin, start", a: "end, finish", ex: "The river is said to ______ high up in the mountains." },
        { u: 18, w: "recognition", d: "Acknowledgment or appreciation.", s: "praise, credit", a: "disregard, neglect", ex: "The brave soldier received a medal in ______ of his service." },
        { u: 18, w: "tribute", d: "Something given or done to show respect.", s: "praise, honor", a: "insult, criticism", ex: "We held a short ______ to honor the founder of the school." }
    ];

    let state = {
        xp: 0, missed: [], pool: [], currentIndex: 0, currentActivity: null,
        isReviewing: false, inputMode: 'choice', isTestMode: false,
        testScore: 0, testTotal: 0, testQueue: [], lastTestSection: null,
        mmGuesses: [], mmWrong: 0, mmWord: "",
        matchCards: [], matchFlipped: [], matchType: 'syn',
        synTarget: null, synType: 'syn',
        spellWord: "", cardFlipped: false, alphaOrder: []
    };

    const STORAGE_KEY = 'macvocab_v6_3';

    window.onload = () => {
        loadData();
        buildUnitSelector();
        updateReviewUI();
        
        // Add Global Enter Key Listener for Spelling Input
        document.getElementById('spell-input').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                checkSpelling();
            }
        });
    };

    function loadData() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
            const data = JSON.parse(saved);
            state.xp = data.xp || 0;
            state.missed = data.missed || [];
        }
        updateXP();
    }

    function saveData() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify({ xp: state.xp, missed: state.missed }));
        updateXP();
        updateReviewUI();
    }

    function updateXP() { document.getElementById('total-xp').innerText = state.xp; }

    function addMissed(item) {
        if (!state.missed.some(i => i.w === item.w)) {
            state.missed.push(item);
            saveData();
        }
    }

    function updateReviewUI() {
        const btn = document.getElementById('btn-review');
        const count = state.missed.length;
        
        btn.innerText = state.isReviewing 
            ? `REVIEWING ${count} WORDS`
            : `REVIEW MISSED WORDS (${count})`;
            
        if (count === 0) {
            btn.disabled = true;
            btn.classList.remove('has-data', 'active');
            state.isReviewing = false;
        } else {
            btn.disabled = false;
            btn.classList.add('has-data');
            if (state.isReviewing) btn.classList.add('active');
            else btn.classList.remove('active');
        }
        document.getElementById('unit-select').disabled = state.isReviewing;
    }

    function toggleReviewMode() {
        if (state.missed.length === 0) return;
        state.isReviewing = !state.isReviewing;
        updateReviewUI();
    }

    function resetData() {
        if(confirm("Reset all XP and missed words?")) {
            localStorage.removeItem(STORAGE_KEY);
            state.xp = 0; state.missed = []; state.isReviewing = false;
            updateXP(); updateReviewUI();
        }
    }

    function buildUnitSelector() {
        const sel = document.getElementById('unit-select');
        const units = [...new Set(RAW_DATA.map(d => d.u))].sort((a,b)=>a-b);
        let opt = document.createElement('option');
        opt.value = 'all'; opt.innerText = "All Units";
        sel.appendChild(opt);
        const maxUnit = Math.max(...units);
        for(let i=1; i<=maxUnit; i+=3) {
            if(units.some(u => u >= i && u < i+3)) {
                opt = document.createElement('option');
                opt.value = `group-${i}`; opt.innerText = `Units ${i}-${i+2}`;
                sel.appendChild(opt);
            }
        }
        units.forEach(u => {
            opt = document.createElement('option');
            opt.value = u; opt.innerText = `Unit ${u}`;
            sel.appendChild(opt);
        });
    }

    function getPool() {
        if (state.isReviewing) return [...state.missed]; 
        const val = document.getElementById('unit-select').value;
        if(val === 'all') return [...RAW_DATA];
        if(val.startsWith('group-')) {
            const start = parseInt(val.split('-')[1]);
            return RAW_DATA.filter(d => d.u >= start && d.u < start+3);
        }
        return RAW_DATA.filter(d => d.u == val);
    }

    function shuffle(arr) { 
        let a = [...arr]; 
        return a.sort(() => Math.random() - 0.5); 
    }
    function cleanString(s) { return s.trim().toLowerCase(); }

    // --- ACTIVITY ROUTER ---
    function startRandomGame() {
        const games = ['quiz', 'macman', 'sentence', 'synant', 'spell', 'alpha', 'jumble', 'match'];
        const randomGame = games[Math.floor(Math.random() * games.length)];
        setActivity(randomGame);
    }

    function setActivity(act) {
        state.isTestMode = false;
        state.pool = shuffle(getPool());
        if(state.pool.length === 0) { alert("No words available!"); return; }
        
        state.inputMode = document.getElementById('input-mode').value;
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        state.currentIndex = 0;
        state.currentActivity = act;
        
        // Reset Visuals
        document.querySelectorAll('.feedback-area').forEach(el => el.className = 'feedback-area');

        const loaders = {
            'quiz': startQuiz, 'macman': startMacMan, 'sentence': startSentence,
            'match': startMatch, 'synant': startSynAnt, 'spell': startSpell, 
            'alpha': startAlpha, 'jumble': startJumble, 'cards': startCards
        };
        if(loaders[act]) loaders[act]();
    }

    function quitGame() {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById('start-screen').classList.add('active');
        updateReviewUI();
    }

    // --- UNIT TEST LOGIC ---
    function startUnitTest() {
        state.pool = shuffle(getPool());
        if(state.pool.length < 4) { alert("Need at least 4 words for a test!"); return; }
        
        state.isTestMode = true;
        state.testScore = 0;
        state.testQueue = [];
        state.lastTestSection = null;
        
        // Build Test Queue: 3 Quiz, 3 Sent, 3 Spell, 3 SynAnt (if data allows)
        const makeTask = (type) => ({ type: type, item: state.pool[Math.floor(Math.random()*state.pool.length)] });
        
        for(let i=0; i<3; i++) state.testQueue.push(makeTask('quiz'));
        for(let i=0; i<3; i++) state.testQueue.push(makeTask('sentence'));
        for(let i=0; i<3; i++) state.testQueue.push(makeTask('spell'));
        
        const synPool = state.pool.filter(w => (w.s && w.s.length > 2) || (w.a && w.a.length > 2));
        if(synPool.length > 0) {
            for(let i=0; i<3; i++) state.testQueue.push({ type: 'synant', item: synPool[Math.floor(Math.random()*synPool.length)] });
        }

        state.testTotal = state.testQueue.length;
        state.currentIndex = 0;
        
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        runTestStep();
    }

    function runTestStep() {
        if(state.currentIndex >= state.testQueue.length) {
            showReportCard();
            return;
        }
        
        const task = state.testQueue[state.currentIndex];
        
        if (task.type !== state.lastTestSection) {
            showInterstitial(task.type);
            state.lastTestSection = task.type;
            return; 
        }

        const realPool = state.pool; 
        state.pool = [task.item];
        
        if(task.type === 'quiz') startQuiz(true);
        else if(task.type === 'sentence') startSentence(true);
        else if(task.type === 'spell') startSpell(true);
        else if(task.type === 'synant') startSynAnt(true);
        
        state.pool = realPool; 
    }

    function showInterstitial(type) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        const screen = document.getElementById('interstitial-screen');
        screen.classList.add('active');
        
        let title = "NEXT SECTION";
        let sub = "Get Ready...";
        
        if (type === 'quiz') { title = "DEFINITIONS"; sub = "Choose the matching word"; }
        else if (type === 'sentence') { title = "SENTENCES"; sub = "Fill in the blank"; }
        else if (type === 'spell') { title = "SPELLING"; sub = "Memorize and type"; }
        else if (type === 'synant') { title = "SYNONYMS & ANTONYMS"; sub = "Find the relationship"; }
        
        document.getElementById('inter-title').innerText = title;
        document.getElementById('inter-sub').innerText = sub;
        
        setTimeout(() => {
            screen.classList.remove('active');
            runTestStep();
        }, 2000);
    }

    function showReportCard() {
        const pct = Math.round((state.testScore / state.testTotal) * 100);
        document.getElementById('report-percent').innerText = pct + "%";
        document.getElementById('report-fraction').innerText = `${state.testScore} / ${state.testTotal} Correct`;
        document.getElementById('report-modal').style.display = 'flex';
    }

    function closeReportCard() {
        document.getElementById('report-modal').style.display = 'none';
        quitGame();
    }

    // --- CENTRAL GAME LOOP LOGIC ---
    function handleTurnResult(isCorrect, feedbackElId, nextRoundFn, item) {
        const feedback = document.getElementById(feedbackElId);
        const win = document.getElementById('main-window');
        
        feedback.className = 'feedback-area';
        win.classList.remove('shake-effect');
        
        if (isCorrect) {
            if(state.isTestMode) state.testScore++;
            else { state.xp += 10; saveData(); }
            
            feedback.classList.add('correct-state');
            feedback.innerHTML = `CORRECT!`;
            setTimeout(() => {
                feedback.className = 'feedback-area';
                advanceGame(nextRoundFn);
            }, 1000);
        } else {
            addMissed(item);
            void win.offsetWidth; win.classList.add('shake-effect');
            feedback.classList.add('wrong-state');
            feedback.innerHTML = `CORRECT: ${item.w.toUpperCase()}`;
            setTimeout(() => {
                feedback.className = 'feedback-area';
                advanceGame(nextRoundFn);
            }, 3000);
        }
    }

    function advanceGame(nextRoundFn) {
        if (state.isTestMode) {
            state.currentIndex++; 
            runTestStep();
        } else {
            state.currentIndex++;
            if(state.currentIndex >= state.pool.length) state.currentIndex = 0;
            nextRoundFn();
        }
    }

    // === QUIZ ===
    function startQuiz(isTest) {
        document.getElementById('quiz-screen').classList.add('active'); 
        loadQuizQ(isTest ? 0 : state.currentIndex); 
    }
    function loadQuizQ(idx) {
        const idxToUse = (typeof idx !== 'undefined') ? idx : state.currentIndex;
        const item = state.pool[idxToUse];
        
        const prog = state.isTestMode ? `${state.currentIndex+1}/${state.testTotal}` : `${idxToUse+1}/${state.pool.length}`;
        document.getElementById('quiz-progress').innerText = prog;
        
        document.getElementById('quiz-def').innerText = item.d;
        document.getElementById('quiz-feedback').innerHTML = "";
        const area = document.getElementById('quiz-interaction-area'); area.innerHTML = '';

        if (state.inputMode === 'choice') {
            area.className = 'choices-grid';
            let distractors = shuffle(RAW_DATA.filter(x => x.w !== item.w)).slice(0, 5);
            let choices = shuffle([item, ...distractors]);
            choices.forEach(c => {
                const btn = document.createElement('button');
                btn.className = 'btn'; btn.innerText = c.w;
                btn.onclick = () => {
                    Array.from(area.children).forEach(b => b.disabled = true);
                    handleTurnResult(c.w === item.w, 'quiz-feedback', () => loadQuizQ(), item);
                };
                area.appendChild(btn);
            });
        } else {
            area.className = '';
            const input = document.createElement('input');
            input.type = 'text'; input.placeholder = 'Type word here...';
            input.style.textAlign = 'center'; input.autocomplete = 'off';
            const btn = document.createElement('button');
            btn.className = 'btn btn-block'; btn.innerText = 'Submit'; btn.style.marginTop = '10px';
            const submit = () => {
                if(input.disabled) return;
                input.disabled = true; btn.disabled = true; 
                handleTurnResult(cleanString(input.value) === cleanString(item.w), 'quiz-feedback', () => loadQuizQ(), item);
            };
            btn.onclick = submit; input.addEventListener('keypress', (e) => { if(e.key === 'Enter') submit(); });
            area.appendChild(input); area.appendChild(btn);
            input.focus();
        }
    }

    // === MACMAN ===
    function startMacMan() { document.getElementById('macman-screen').classList.add('active'); loadMacMan(); }
    function loadMacMan() {
        const item = state.pool[state.currentIndex];
        state.mmWord = item.w.toLowerCase(); state.mmGuesses = []; state.mmWrong = 0;
        document.getElementById('mm-hint').innerText = `Hint: ${item.d}`;
        document.getElementById('mm-feedback').innerHTML = "";
        drawMacMan(0); updateMacManUI();
        const kb = document.getElementById('mm-keys'); kb.innerHTML = '';
        "abcdefghijklmnopqrstuvwxyz".split('').forEach(l => {
            const b = document.createElement('button'); b.className = 'btn key-btn'; b.innerText = l;
            b.onclick = () => guessMacMan(l, b); kb.appendChild(b);
        });
    }
    function guessMacMan(l, btn) {
        btn.disabled = true; state.mmGuesses.push(l);
        if(state.mmWord.includes(l)) {
            updateMacManUI();
            if(!document.getElementById('mm-word').innerText.includes('_')) {
                handleTurnResult(true, 'mm-feedback', loadMacMan, state.pool[state.currentIndex]);
            }
        } else {
            state.mmWrong++; drawMacMan(state.mmWrong);
            if(state.mmWrong >= 6) {
                document.getElementById('mm-word').innerText = state.mmWord; 
                handleTurnResult(false, 'mm-feedback', loadMacMan, state.pool[state.currentIndex]);
            }
        }
    }
    function updateMacManUI() {
        document.getElementById('mm-word').innerText = state.mmWord.split('').map(c => state.mmGuesses.includes(c) ? c : "_").join(" ");
    }
    function drawMacMan(errs) {
        const ctx = document.getElementById('macman-canvas').getContext('2d');
        ctx.clearRect(0,0,100,100); ctx.strokeStyle = "#000"; ctx.lineWidth = 2; ctx.beginPath();
        if(errs > 0) { ctx.moveTo(10,90); ctx.lineTo(90,90); ctx.moveTo(30,90); ctx.lineTo(30,10); ctx.lineTo(70,10); ctx.lineTo(70,20); }
        if(errs > 1) { ctx.moveTo(80,30); ctx.arc(70,30,10,0,Math.PI*2); }
        if(errs > 2) { ctx.moveTo(70,40); ctx.lineTo(70,70); }
        if(errs > 3) { ctx.moveTo(70,50); ctx.lineTo(55,65); }
        if(errs > 4) { ctx.moveTo(70,50); ctx.lineTo(85,65); }
        if(errs > 5) { ctx.moveTo(70,70); ctx.lineTo(55,85); ctx.moveTo(70,70); ctx.lineTo(85,85); }
        ctx.stroke();
    }

    // === SENTENCES ===
    function startSentence(isTest) {
        document.getElementById('sentence-screen').classList.add('active'); 
        loadSentence(isTest ? 0 : state.currentIndex);
    }
    function loadSentence(idx) {
        const idxToUse = (typeof idx !== 'undefined') ? idx : state.currentIndex;
        const item = state.pool[idxToUse];
        const prog = state.isTestMode ? `${state.currentIndex+1}/${state.testTotal}` : `${idxToUse+1}/${state.pool.length}`;
        document.getElementById('sent-progress').innerText = prog;
        
        document.getElementById('sent-text').innerHTML = item.ex.replace('______', '<span class="blank-spot"></span>');
        document.getElementById('sent-feedback').innerHTML = '';
        const area = document.getElementById('sent-interaction-area'); area.innerHTML = '';

        if (state.inputMode === 'choice') {
            area.className = 'choices-grid';
            let distractors = shuffle(RAW_DATA.filter(x => x.w !== item.w)).slice(0, 5); 
            let choices = shuffle([item, ...distractors]);
            choices.forEach(c => {
                const btn = document.createElement('button'); btn.className = 'btn'; btn.innerText = c.w;
                btn.onclick = () => {
                    Array.from(area.children).forEach(b => b.disabled = true);
                    handleTurnResult(c.w === item.w, 'sent-feedback', () => loadSentence(), item);
                };
                area.appendChild(btn);
            });
        } else {
            area.className = '';
            const input = document.createElement('input');
            input.type = 'text'; input.placeholder = 'Type missing word...';
            input.autocomplete = 'off'; input.style.textAlign = 'center';
            const btn = document.createElement('button');
            btn.className = 'btn btn-block'; btn.innerText = 'Check Answer'; btn.style.marginTop = '10px';
            const submit = () => {
                if(input.disabled) return;
                input.disabled = true; btn.disabled = true;
                handleTurnResult(cleanString(input.value) === cleanString(item.w), 'sent-feedback', () => loadSentence(), item);
            };
            btn.onclick = submit; input.addEventListener('keypress', (e)=>{if(e.key==='Enter')submit()});
            area.appendChild(input); area.appendChild(btn); input.focus();
        }
    }

    // === TILE MATCH (MEMORY) ===
    function startMatch() { document.getElementById('match-screen').classList.add('active'); state.matchType = (Math.random() > 0.5) ? 'syn' : 'ant'; loadMatch(); }
    function loadMatch() {
        document.getElementById('match-mode-label').innerText = state.matchType === 'syn' ? 'Match Synonyms' : 'Match Antonyms';
        document.getElementById('match-feedback').innerHTML = "";
        let usable = state.pool.filter(w => { const val = state.matchType === 'syn' ? w.s : w.a; return val && val.length > 2; });
        if (usable.length < 6) usable = state.pool;
        let roundWords = shuffle(usable).slice(0, 6);
        state.matchCards = []; state.matchFlipped = [];
        roundWords.forEach((item, idx) => {
            state.matchCards.push({ id: idx*2, text: item.w, pairId: idx, matched: false });
            let pairText = (state.matchType === 'syn' ? item.s : item.a) || "???";
            pairText = pairText.split(',')[0].trim();
            state.matchCards.push({ id: idx*2+1, text: pairText, pairId: idx, matched: false });
        });
        state.matchCards = shuffle(state.matchCards);
        renderMatchGrid();
    }
    function renderMatchGrid() {
        const grid = document.getElementById('match-grid'); grid.innerHTML = '';
        state.matchCards.forEach((card, index) => {
            const el = document.createElement('div'); el.className = 'tile-card hidden';
            if (card.matched) el.classList.add('matched');
            if (state.matchFlipped.includes(index)) { el.className = 'tile-card flipped'; el.innerText = card.text; } else { el.innerText = ''; }
            el.onclick = () => clickMatchCard(index); grid.appendChild(el);
        });
    }
    function clickMatchCard(index) {
        if (state.matchFlipped.includes(index) || state.matchCards[index].matched || state.matchFlipped.length >= 2) return;
        state.matchFlipped.push(index); renderMatchGrid();
        if (state.matchFlipped.length === 2) {
            const idx1 = state.matchFlipped[0]; const idx2 = state.matchFlipped[1];
            if (state.matchCards[idx1].pairId === state.matchCards[idx2].pairId) {
                setTimeout(() => {
                    state.matchCards[idx1].matched = true; state.matchCards[idx2].matched = true;
                    state.matchFlipped = []; renderMatchGrid();
                    state.xp += 5; saveData(); document.getElementById('match-score').innerText = `Score: ${Math.floor(state.xp/5)}`;
                    if (state.matchCards.every(c => c.matched)) {
                        state.xp += 20; saveData();
                        setTimeout(() => { state.matchType = (state.matchType === 'syn') ? 'ant' : 'syn'; loadMatch(); }, 2000);
                    }
                }, 500);
            } else { setTimeout(() => { state.matchFlipped = []; renderMatchGrid(); }, 1000); }
        }
    }

    // === SYN/ANT ID ===
    function startSynAnt(isTest) {
        document.getElementById('synant-screen').classList.add('active');
        if (!isTest) {
            let attempts = 0;
            while(attempts < state.pool.length) {
                const item = state.pool[state.currentIndex];
                const hasSyn = item.s && item.s.length > 2;
                const hasAnt = item.a && item.a.length > 2;
                if(hasSyn || hasAnt) break;
                state.currentIndex++;
                if(state.currentIndex >= state.pool.length) state.currentIndex = 0;
                attempts++;
            }
        }
        loadSynAnt(isTest ? 0 : state.currentIndex);
    }

    function loadSynAnt(idx) {
        const idxToUse = (typeof idx !== 'undefined') ? idx : state.currentIndex;
        const item = state.pool[idxToUse];
        const prog = state.isTestMode ? `${state.currentIndex+1}/${state.testTotal}` : `${idxToUse+1}/${state.pool.length}`;
        document.getElementById('synant-progress').innerText = prog;
        
        const hasSyn = item.s && item.s.length > 2;
        const hasAnt = item.a && item.a.length > 2;
        state.synType = (hasSyn && hasAnt) ? (Math.random()>0.5 ? 'syn' : 'ant') : (hasSyn ? 'syn' : 'ant');
        
        const sourceStr = state.synType === 'syn' ? item.s : item.a;
        const clueWord = sourceStr.split(',')[0].trim().toUpperCase();
        
        document.getElementById('synant-clue').innerText = clueWord;
        document.getElementById('synant-type').innerText = state.synType === 'syn' ? 'synonym' : 'antonym';
        
        document.getElementById('synant-feedback').innerHTML = "";
        const area = document.getElementById('synant-interaction-area'); area.innerHTML = '';

        if (state.inputMode === 'choice') {
            area.className = 'choices-grid';
            let distractors = shuffle(RAW_DATA.filter(x => x.w !== item.w)).slice(0, 5); 
            let choices = shuffle([item, ...distractors]);
            choices.forEach(c => {
                const btn = document.createElement('button'); btn.className = 'btn'; btn.innerText = c.w;
                btn.onclick = () => {
                    Array.from(area.children).forEach(b => b.disabled = true);
                    handleTurnResult(c.w === item.w, 'synant-feedback', () => loadSynAnt(), item);
                };
                area.appendChild(btn);
            });
        } else {
            area.className = '';
            const input = document.createElement('input');
            input.type = 'text'; input.placeholder = 'Type word here...';
            input.style.textAlign = 'center'; input.autocomplete = 'off';
            const btn = document.createElement('button');
            btn.className = 'btn btn-block'; btn.innerText = 'Submit'; btn.style.marginTop = '10px';
            const submit = () => {
                if(input.disabled) return;
                input.disabled = true; btn.disabled = true;
                handleTurnResult(cleanString(input.value) === cleanString(item.w), 'synant-feedback', () => loadSynAnt(), item);
            };
            btn.onclick = submit; input.addEventListener('keypress', (e)=>{if(e.key==='Enter')submit()});
            area.appendChild(input); area.appendChild(btn); input.focus();
        }
    }

    // === FLASH & SPELL ===
    function startSpell(isTest) {
        document.getElementById('spell-screen').classList.add('active'); 
        loadSpell(isTest ? 0 : state.currentIndex);
    }
    function loadSpell(idx) {
        const idxToUse = (typeof idx !== 'undefined') ? idx : state.currentIndex;
        const item = state.pool[idxToUse];
        const prog = state.isTestMode ? `${state.currentIndex+1}/${state.testTotal}` : `${idxToUse+1}/${state.pool.length}`;
        document.getElementById('spell-progress').innerText = prog;
        
        state.spellWord = item.w;
        const inp = document.getElementById('spell-input');
        const btn = document.querySelector('#spell-phase-2 button');
        inp.disabled = false; inp.value = ''; if(btn) btn.disabled = false;

        document.getElementById('spell-phase-1').style.display = 'flex';
        document.getElementById('spell-phase-2').style.display = 'none';
        document.getElementById('spell-word-display').innerText = item.w;
        document.getElementById('spell-def-display').innerText = item.d;
        document.getElementById('spell-feedback').innerHTML = "";
        const bar = document.getElementById('spell-timer');
        bar.style.width = "100%"; void bar.offsetWidth; bar.style.width = "0%";
        setTimeout(() => {
            document.getElementById('spell-phase-1').style.display = 'none';
            document.getElementById('spell-phase-2').style.display = 'flex';
            inp.focus();
        }, 1000);
    }
    function checkSpelling() {
        const val = document.getElementById('spell-input').value;
        const btn = document.querySelector('#spell-phase-2 button'); 
        if (document.getElementById('spell-input').disabled) return; 
        document.getElementById('spell-input').disabled = true; if(btn) btn.disabled = true;
        handleTurnResult(cleanString(val) === cleanString(state.spellWord), 'spell-feedback', () => loadSpell(), state.pool[state.isTestMode?0:state.currentIndex]);
    }

    // === JUMBLE ===
    function startJumble() { document.getElementById('jumble-screen').classList.add('active'); loadJumble(); }
    function loadJumble() {
        const item = state.pool[state.currentIndex];
        document.getElementById('jumble-progress').innerText = `${state.currentIndex+1}/${state.pool.length}`;
        const scrambled = item.w.split('').sort(() => Math.random() - 0.5).join('');
        document.getElementById('jumble-word').innerText = scrambled;
        document.getElementById('jumble-feedback').innerHTML = "";
        const area = document.getElementById('jumble-interaction-area'); area.innerHTML = '';
        area.className = '';
        const input = document.createElement('input');
        input.type = 'text'; input.placeholder = 'Unscramble...';
        input.style.textAlign = 'center'; input.autocomplete = 'off';
        const btn = document.createElement('button');
        btn.className = 'btn btn-block'; btn.innerText = 'Check'; btn.style.marginTop = '10px';
        const submit = () => {
            if (input.disabled) return;
            input.disabled = true; btn.disabled = true;
            handleTurnResult(cleanString(input.value) === cleanString(item.w), 'jumble-feedback', loadJumble, item);
        };
        btn.onclick = submit; input.addEventListener('keypress', (e)=>{if(e.key==='Enter')submit()});
        area.appendChild(input); area.appendChild(btn); input.focus();
    }

    // === ALPHA ===
    function startAlpha() { document.getElementById('alpha-screen').classList.add('active'); loadAlpha(); }
    function loadAlpha() {
        const container = document.getElementById('alpha-container'); container.innerHTML = '';
        document.getElementById('alpha-feedback').innerHTML = '';
        const round = shuffle([...state.pool]).slice(0, 5);
        state.alphaOrder = [...round].sort((a,b) => a.w.localeCompare(b.w));
        round.forEach(item => {
            const div = document.createElement('div'); div.className = 'alpha-item'; div.innerText = item.w;
            div.onclick = (e) => checkAlpha(item, div); container.appendChild(div);
        });
    }
    function checkAlpha(item, el) {
        if(item.w === state.alphaOrder[0].w) {
            el.classList.add('done'); state.alphaOrder.shift(); 
            if(state.alphaOrder.length === 0) {
                state.xp += 15; saveData(); setTimeout(loadAlpha, 1500);
            }
        } else {
            const win = document.getElementById('main-window');
            void win.offsetWidth; win.classList.add('shake-effect');
        }
    }

    // === CARDS ===
    function startCards() { document.getElementById('cards-screen').classList.add('active'); state.currentIndex = 0; loadCard(); }
    function loadCard() {
        if(state.currentIndex < 0) state.currentIndex = state.pool.length - 1;
        if(state.currentIndex >= state.pool.length) state.currentIndex = 0;
        state.cardFlipped = false; renderCard();
        document.getElementById('card-count').innerText = `${state.currentIndex+1}/${state.pool.length}`;
    }
    function renderCard() {
        const item = state.pool[state.currentIndex];
        const content = document.getElementById('card-content');
        if(!state.cardFlipped) { content.innerHTML = `<div class="main-word">${item.w}</div>`; }
        else {
            content.innerHTML = `<div style="font-size:1.1rem; font-weight:bold;">${item.d}</div>
                <hr style="width:50%; margin:10px auto; border:0; border-top:1px dashed #000;">
                <div style="font-size:1rem;">Syn: ${item.s || '-'}</div>
                <div style="font-size:1rem;">Ant: ${item.a || '-'}</div>`;
        }
    }
    function flipCard() { state.cardFlipped = !state.cardFlipped; renderCard(); }
    function nextCard() { state.currentIndex++; loadCard(); }
    function prevCard() { state.currentIndex--; loadCard(); }

</script>
</body>
</html>
